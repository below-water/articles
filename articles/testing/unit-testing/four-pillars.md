# 良い単体テストを構成する4本の柱

優れた単体テストのテストスイートは、最小限の保守コストで最大限の価値を生み出す。
これを実現するためには、価値のあるテストケースを認識できなければならない。
テストケースを分析するのに使う基準となる枠組みであり、良い単体テストを構成する4本の柱は以下である。

- リグレッションに対する保護
- リファクタリングへの耐性
- 迅速なフィードバック
- 保守のしやすさ

## リグレッションに対する保護

以下の観点に着目すると、より多くのリグレッションを防ぐことができる。

- テスト時に実行されるプロダクションコードの量
  - 量が増えるほど、リグレッションが見つかる可能性は高くなる
- テスト対象のコードの複雑さ
  - ビジネスロジックのコードは複雑なほど重要になる
- テスト対象のコードのドメインにおける重要性
  - ビジネス的に重要な機能ほど、バグによる被害も大きい

重要でないコードをテストする価値はほとんどない。

アプリケーションに対する影響が大きいため、ライブラリやフレームワークのコードも考慮する必要がある。

## リファクタリングへの耐性

偽陽性(false positive)とは、テスト対象のコードには問題がないのにテストが失敗すること。
プロダクションコードをリファクタリングする際に起こる。
リファクタリングへの耐性とは、リファクタリングを行なっても偽陽性が生まれにくい性質のこと(と本書では呼ぶ)。

リファクタリングへの耐性があるか評価するには、そのテストケースを実行することでどのくらいの偽陽性が発生するのか計測する。

単体テストによって、

- バグを検出できる
- プロダクションコードを変更してもテストを実行できるので、リファクタリングをしようと思える

しかし、偽陽性に対して注意を払わないと、テストが失敗することに慣れてしまいテスト結果を重要視しなくなる。
