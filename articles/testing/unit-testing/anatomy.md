# 単体テストの構造的解析

## AAAパターン

AAAパターンとは、テストケースを、準備(Arrange)、実行(Act)、確認(Assert)のフェーズで構成すること。

<https://github.com/suimenkathemove/rust_sandbox/blob/12c14c6ad3c4de764d96ee03fb5e4cf1c0a424af/unit_testing/src/calculator.rs>

統一された構造を持つことによって、テストの可読性が上がる。

| name            | description                                                                                                    |
| --------------- | -------------------------------------------------------------------------------------------------------------- |
| Arrangeフェーズ | テストケースの事前条件を満たすフェーズ。                                                                       |
| Actフェーズ     | テスト対象の振る舞いを実行させるフェーズ。                                                                     |
| Assertフェーズ  | 実行結果を確認するフェーズ。                                                                                   |
|                 | 実行結果は、戻り値の場合もあれば、テスト対象システムやその協力者オブジェクトの実行後の状態の場合もある。       |
|                 | テスト対象システムによって、想定する協力者オブジェクトのメソッドが呼び出されたことが確認対象となる場合もある。 |

テスト対象システム(System Under Test: SUT)とは、テスト対象のオブジェクトのこと。

テスト内での順番はこの順番だが、確認フェーズから書き始める選択肢もある(TDDの場合など)。

Given-When-Thenパターンもあり、AAAパターンとほぼ同じだが、非開発者にとって読みやすい。

## 単体テストにおいて回避すべきこと

### 1つのテストケース内で同じフェーズを複数用意すること

1つのテストケース内では1つの振る舞いしか検証すべきではない。

統合テストにおいて実行時間が長くなっている場合は、

- 1つのテストケース内で同じフェーズを複数含めることが効率的な場合もある。
- テスト対象の処理を行うことでシステムの状態が次の検証の事前条件に自然となる場合は、まとめた方が効率的な場合もある。

### if文の使用

if文があると理解しづらくなり保守コストが高くなるので、単体テストなのか統合テストなのかにかかわらず、分岐のない単純な流れにしなくてはならない。
